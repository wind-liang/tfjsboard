{"version":3,"sources":["node_modules/@babel/runtime/helpers/setPrototypeOf.js","node_modules/@babel/runtime/helpers/construct.js","node_modules/@babel/runtime/helpers/classCallCheck.js","node_modules/@babel/runtime/helpers/createClass.js","gua_game.js"],"names":["GuaGame","fps","images","runCallback","window","scene","actions","keydowns","canvas","document","querySelector","context","getContext","self","addEventListener","event","key","init","img","drawImage","image","x","y","update","draw","callback","log","g","Object","keys","i","length","clearRect","width","height","setTimeout","runloop","name","w","h","loads","names","path","Image","src","onload","push","__start","args"],"mappings":"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","file":"gua_game.b8c7bf29.map","sourceRoot":"..","sourcesContent":["function _setPrototypeOf(o, p) {\n  module.exports = _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nmodule.exports = _setPrototypeOf;","var setPrototypeOf = require(\"./setPrototypeOf\");\n\nfunction isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _construct(Parent, args, Class) {\n  if (isNativeReflectConstruct()) {\n    module.exports = _construct = Reflect.construct;\n  } else {\n    module.exports = _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nmodule.exports = _construct;","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","// 瓜\nclass GuaGame {\n    constructor(fps, images, runCallback) {\n        window.fps = fps\n        this.images = images\n        this.runCallback = runCallback\n        //\n        this.scene = null\n        this.actions = {}\n        this.keydowns = {}\n        this.canvas = document.querySelector('#id-canvas')\n        this.context = this.canvas.getContext('2d')\n        // events\n        var self = this\n        window.addEventListener('keydown', event => {\n            this.keydowns[event.key] = true\n        })\n        window.addEventListener('keyup', function(event){\n            self.keydowns[event.key] = false\n        })\n        this.init()\n    }\n\n    static instance(...args) {\n        this.i = this.i || new this(...args)\n        return this.i\n    }\n    drawImage(img) {\n        this.context.drawImage(img.image, img.x, img.y)\n    }\n    // update\n    update() {\n        this.scene.update()\n    }\n    // draw\n    draw() {\n        this.scene.draw()\n    }\n    //\n    registerAction(key, callback) {\n        this.actions[key] = callback\n    }\n    runloop() {\n        log(window.fps)\n        // events\n        var g = this\n        var actions = Object.keys(g.actions)\n        for (var i = 0; i < actions.length; i++) {\n            var key = actions[i]\n            if(g.keydowns[key]) {\n                // 如果按键被按下, 调用注册的 action\n                g.actions[key]()\n            }\n        }\n        // update\n        g.update()\n        // clear\n        g.context.clearRect(0, 0, g.canvas.width, g.canvas.height)\n        // draw\n        g.draw()\n        // next run loop\n        setTimeout(function(){\n            g.runloop()\n        }, 1000/window.fps)\n    }\n    imageByName(name) {\n        var g = this\n        log('image by name', g.images)\n        var img = g.images[name]\n        var image = {\n            w: img.width,\n            h: img.height,\n            image: img,\n        }\n        return image\n    }\n    runWithScene(scene) {\n        var g = this\n        g.scene = scene\n        // 开始运行程序\n        setTimeout(function(){\n            g.runloop()\n        }, 1000/window.fps)\n    }\n    replaceScene(scene) {\n        this.scene = scene\n    }\n    __start(scene) {\n        this.runCallback(this)\n    }\n\n    init() {\n        var g = this\n        var loads = []\n        // 预先载入所有图片\n        var names = Object.keys(g.images)\n        for (var i = 0; i < names.length; i++) {\n            let name = names[i]\n            var path = g.images[name]\n            let img = new Image()\n            img.src = path\n            img.onload = function() {\n                // 存入 g.images 中\n                g.images[name] = img\n                // 所有图片都成功载入之后, 调用 run\n                loads.push(1)\n                log('load images', loads.length, names.length)\n                if (loads.length == names.length) {\n                    log('load images', g.images)\n                    g.__start()\n                }\n            }\n        }\n    }\n}\n"]}