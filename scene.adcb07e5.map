{"version":3,"sources":["scene/main/scene.js"],"names":["Scene","game","s","paddle","Paddle","ball","Ball","score","blocks","loadLevel","registerAction","moveLeft","moveRight","fire","draw","context","fillStyle","fillRect","drawImage","i","length","block","alive","fillText","update","window","paused","move","y","end","SceneEnd","new","replaceScene","collide","反弹","kill","enableDrag","canvas","addEventListener","event","x","offsetX","offsetY","log","hasPoint"],"mappings":"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","file":"scene.adcb07e5.map","sourceRoot":"..","sourcesContent":["var Scene = function(game) {\n    var s = {\n        game: game,\n    }\n    // 初始化\n    var paddle = Paddle(game)\n    var ball = Ball(game)\n\n    var score = 0\n\n    var blocks = loadLevel(game, 1)\n\n    game.registerAction('a', function(){\n        paddle.moveLeft()\n    })\n    game.registerAction('d', function(){\n        paddle.moveRight()\n    })\n    game.registerAction('f', function(){\n        ball.fire()\n    })\n\n    s.draw = function() {\n        // draw 背景\n        game.context.fillStyle = \"#554\"\n        game.context.fillRect(0, 0, 400, 300)\n        // draw\n        game.drawImage(paddle)\n        game.drawImage(ball)\n        // draw blocks\n        for (var i = 0; i < blocks.length; i++) {\n            var block = blocks[i]\n            if (block.alive) {\n                game.drawImage(block)\n            }\n        }\n        // draw labels\n        game.context.fillText('分数: ' + score, 10, 290)\n    }\n    s.update = function() {\n        if (window.paused) {\n            return\n        }\n\n        ball.move()\n        // 判断游戏结束\n        if (ball.y > paddle.y) {\n            // 跳转到 游戏结束 的场景\n            var end = SceneEnd.new(game)\n            game.replaceScene(end)\n        }\n        // 判断相撞\n        if (paddle.collide(ball)) {\n            // 这里应该调用一个 ball.反弹() 来实现\n            ball.反弹()\n        }\n        // 判断 ball 和 blocks 相撞\n        for (var i = 0; i < blocks.length; i++) {\n            var block = blocks[i]\n            if (block.collide(ball)) {\n                // log('block 相撞')\n                block.kill()\n                ball.反弹()\n                // 更新分数\n                score += 100\n            }\n        }\n    }\n\n    // mouse event\n    var enableDrag = false\n    game.canvas.addEventListener('mousedown', function(event) {\n        var x = event.offsetX\n        var y = event.offsetY\n        log(x, y, event)\n        // 检查是否点中了 ball\n        if (ball.hasPoint(x, y)) {\n            // 设置拖拽状态\n            enableDrag = true\n        }\n    })\n    game.canvas.addEventListener('mousemove', function(event) {\n        var x = event.offsetX\n        var y = event.offsetY\n        // log(x, y, 'move')\n        if (enableDrag) {\n            log(x, y, 'drag')\n            ball.x = x\n            ball.y = y\n        }\n    })\n    game.canvas.addEventListener('mouseup', function(event) {\n        var x = event.offsetX\n        var y = event.offsetY\n        log(x, y, 'up')\n        enableDrag = false\n    })\n\n    return s\n}\n"]}